---
// =============================================================================
// [...slug].astro
//
// Summary: Dynamic route for example pages using content collections.
//
// Handles both HTML routes (/examples/astro) and markdown routes
// (/examples/astro.md). The markdown route returns raw markdown suitable
// for LLM consumption.
// =============================================================================

import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { markdownResponse } from "../../lib/markdown";

export async function getStaticPaths() {
  const examples = await getCollection("examples");
  const paths = [];

  for (const example of examples) {
    // HTML route: /examples/astro
    paths.push({
      params: { slug: example.slug },
      props: { example, format: "html" },
    });
    // Markdown route: /examples/astro.md
    paths.push({
      params: { slug: `${example.slug}.md` },
      props: { example, format: "md" },
    });
  }
  return paths;
}

const { example, format } = Astro.props;

if (format === "md") {
  const md = `# ${example.data.title}

${example.data.description}

[Back to Examples](/examples)

${example.body}
`;
  return markdownResponse(md);
}

const { Content } = await example.render();
const alternateMarkdownUrl = `/examples/${example.slug}.md`;
---

<BaseLayout
  title={`${example.data.title} - ANDO`}
  description={example.data.description}
  alternateMarkdownUrl={alternateMarkdownUrl}
>
  <div class="max-w-3xl">
    <section id="top" class="mb-8 md:mb-12">
      <div class="mb-4">
        <a
          href="/examples"
          class="text-sm text-zinc-500 hover:text-cyan-600 dark:text-zinc-400 dark:hover:text-cyan-400"
          >&larr; All Examples</a
        >
      </div>
      <h1 class="mb-2 text-2xl font-bold text-zinc-900 sm:text-3xl dark:text-white">{example.data.title}</h1>
      <p class="text-zinc-500 dark:text-zinc-400">{example.data.description}</p>
    </section>

    <div
      id="content"
      class="prose prose-zinc dark:prose-invert prose-headings:font-semibold prose-a:text-cyan-600 dark:prose-a:text-cyan-400 prose-code:rounded prose-code:bg-zinc-100 prose-code:px-1 prose-code:before:content-none prose-code:after:content-none dark:prose-code:bg-zinc-800 prose-pre:bg-zinc-900 prose-pre:border prose-pre:border-zinc-800 max-w-none"
    >
      <Content />
    </div>
  </div>
</BaseLayout>
