---
import ProviderLayout from "../../layouts/ProviderLayout.astro";
import OperationsTable from "../../components/OperationsTable.astro";
import OperationDetails from "../../components/OperationDetails.astro";
import CodeBlock from "../../components/CodeBlock.astro";
import { getOperationsForProvider } from "../../data/operations.js";

const operations = getOperationsForProvider("GitHub");

const releaseCode = `// Create a GitHub release with auto-generated notes
var version = Dotnet.BumpVersion(app);

Git.Tag(version);
Git.Push();
Git.PushTags();

GitHub.CreateRelease(o => o
    .WithTag(version)
    .WithGeneratedNotes());

// Create release with custom notes
GitHub.CreateRelease(o => o
    .WithTag(version)
    .WithTitle("v1.0.0 - Initial Release")
    .WithNotes("## What's New\\n- Feature A\\n- Feature B"));

// Create a pre-release
GitHub.CreateRelease(o => o
    .WithTag(version)
    .AsPrerelease());`;

const imageCode = `// Build and push Docker image to GitHub Container Registry
var version = Dotnet.BumpVersion(app);

Docker.Build("Dockerfile", "myapp", version);

GitHub.PushImage("myapp", o => o
    .WithTag(version)
    .WithOwner("my-org"));

// Push with latest tag
GitHub.PushImage("myapp", o => o.WithTag("latest"));`;

const prCode = `// Create a pull request
GitHub.CreatePr(o => o
    .WithTitle("Add new feature")
    .WithBody("## Summary\\nThis PR adds...")
    .WithBase("main"));

// Create a draft PR
GitHub.CreatePr(o => o
    .WithTitle("WIP: New feature")
    .AsDraft());`;
---

<ProviderLayout
  title="GitHub"
  provider="GitHub"
  description="GitHub integration using the gh CLI for releases, pull requests, and container registry."
>
  <section id="operations" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Operations</h2>
    <OperationsTable operations={operations} />
  </section>

  <section id="details" class="mb-8">
    <h2 class="mb-6 text-xl font-bold text-zinc-900 dark:text-white">Operation Details</h2>
    <OperationDetails operations={operations} />
  </section>

  <section id="authentication" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Authentication</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">
      GitHub operations authenticate using one of these methods (checked in order):
    </p>
    <table class="my-3 w-full text-sm">
      <thead>
        <tr class="border-b border-zinc-200 dark:border-zinc-700">
          <th class="px-3 py-3 text-left text-xs font-semibold tracking-wider text-zinc-400 uppercase">Method</th>
          <th class="px-3 py-3 text-left text-xs font-semibold tracking-wider text-zinc-400 uppercase">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-b border-zinc-100 hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-800/50">
          <td class="px-3 py-3"><code class="text-cyan-600 dark:text-cyan-400">GITHUB_TOKEN</code></td>
          <td class="px-3 py-3 text-zinc-600 dark:text-zinc-400">Environment variable (preferred for CI/CD)</td>
        </tr>
        <tr class="border-b border-zinc-100 hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-800/50">
          <td class="px-3 py-3"><code class="text-cyan-600 dark:text-cyan-400">GH_TOKEN</code></td>
          <td class="px-3 py-3 text-zinc-600 dark:text-zinc-400">Alternative environment variable</td>
        </tr>
        <tr class="border-b border-zinc-100 hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-800/50">
          <td class="px-3 py-3"><code class="text-cyan-600 dark:text-cyan-400">gh auth login</code></td>
          <td class="px-3 py-3 text-zinc-600 dark:text-zinc-400">Uses token from ~/.config/gh/hosts.yml</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section id="releases" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Creating Releases</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">
      Create GitHub releases with version tags, release notes, and pre-release flags.
    </p>
    <CodeBlock code={releaseCode} lang="csharp" />
  </section>

  <section id="container-registry" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Container Registry</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">
      Push Docker images to GitHub Container Registry (ghcr.io). The image must be built locally first.
    </p>
    <CodeBlock code={imageCode} lang="csharp" />
  </section>

  <section id="pull-requests" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Pull Requests</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">Create pull requests programmatically.</p>
    <CodeBlock code={prCode} lang="csharp" />
  </section>

  <section id="notes" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Notes</h2>
    <ul class="list-disc space-y-2 pl-5 text-zinc-500 dark:text-zinc-400">
      <li>
        GitHub operations require the <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >gh</code
        > CLI to be installed.
      </li>
      <li>
        When using <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >VersionRef</code
        > with releases, the version is automatically prefixed with 'v'.
      </li>
      <li>
        For <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >PushImage</code
        >, the owner is auto-detected from the git remote if not specified.
      </li>
    </ul>
  </section>
</ProviderLayout>
