---
import ProviderLayout from "../../layouts/ProviderLayout.astro";
import OperationsTable from "../../components/OperationsTable.astro";
import OperationDetails from "../../components/OperationDetails.astro";
import CodeBlock from "../../components/CodeBlock.astro";
import { getOperationsForProvider } from "../../data/operations.js";

const operations = getOperationsForProvider("Docker");

const basicCode = `// Build a Docker image
Docker.Build("Dockerfile", o => o.WithTag("myapp:latest"));

// Build with version from BumpVersion
var version = Dotnet.BumpVersion(app);
Docker.Build("Dockerfile", "myapp", version);  // Creates myapp:1.0.0

// Build with explicit tag
Docker.Build("./src/MyApp/Dockerfile", o => o
    .WithTag("myapp:v1.0.0"));`;

const advancedCode = `// Build with build arguments
Docker.Build("Dockerfile", o => o
    .WithTag("myapp:latest")
    .WithBuildArg("VERSION", "1.0.0")
    .WithBuildArg("BUILD_NUMBER", "123"));

// Specify platform (for cross-compilation)
Docker.Build("Dockerfile", o => o
    .WithTag("myapp:latest")
    .WithPlatform("linux/amd64"));

// Build without cache
Docker.Build("Dockerfile", o => o
    .WithTag("myapp:latest")
    .WithNoCache());

// Specify context directory
Docker.Build("./docker/Dockerfile", o => o
    .WithTag("myapp:latest")
    .WithContext("./src"));`;

const workflowCode = `// Full build and push workflow
var version = Dotnet.BumpVersion(app);

// Build the application
Dotnet.Publish(app, o => o
    .Output(Root / "publish")
    .WithConfiguration(Configuration.Release));

// Build Docker image with version
Docker.Build("Dockerfile", "myapp", version);

// Push to GitHub Container Registry
GitHub.PushImage("myapp", o => o.WithTag(version));

// Create GitHub release
Git.Tag(version);
Git.Push();
Git.PushTags();
GitHub.CreateRelease(o => o.WithTag(version).WithGeneratedNotes());`;
---

<ProviderLayout title="Docker" provider="Docker" description="Build Docker container images using the Docker CLI.">
  <section id="operations" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Operations</h2>
    <OperationsTable operations={operations} />
  </section>

  <section id="details" class="mb-8">
    <h2 class="mb-6 text-xl font-bold text-zinc-900 dark:text-white">Operation Details</h2>
    <OperationDetails operations={operations} />
  </section>

  <section id="basic-usage" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Basic Usage</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">Build Docker images with static or dynamic tags.</p>
    <CodeBlock code={basicCode} lang="csharp" />
  </section>

  <section id="advanced-options" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Advanced Options</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">
      Configure build arguments, platform, caching, and context directory.
    </p>
    <CodeBlock code={advancedCode} lang="csharp" />
  </section>

  <section id="workflow" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Full Workflow Example</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">Build, push, and release a containerized application.</p>
    <CodeBlock code={workflowCode} lang="csharp" />
  </section>

  <section id="notes" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Notes</h2>
    <ul class="list-disc space-y-2 pl-5 text-zinc-500 dark:text-zinc-400">
      <li>Docker operations require Docker to be installed on the host machine.</li>
      <li>
        When using the convenience overload with <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >VersionRef</code
        >, the image name and version are combined automatically (e.g., <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >myapp:1.0.0</code
        >).
      </li>
      <li>
        For pushing images, use the registry-specific operations like <a
          href="/providers/github#container-registry"
          class="text-cyan-600 hover:underline dark:text-cyan-400">GitHub.PushImage</a
        >.
      </li>
      <li>If the dockerfile parameter is a directory, ANDO assumes the Dockerfile is inside that directory.</li>
    </ul>
  </section>
</ProviderLayout>
