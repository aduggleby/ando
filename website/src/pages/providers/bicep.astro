---
import ProviderLayout from "../../layouts/ProviderLayout.astro";
import OperationsTable from "../../components/OperationsTable.astro";
import OperationDetails from "../../components/OperationDetails.astro";
import { getOperationsForProvider } from "../../data/operations.js";

const operations = getOperationsForProvider("Bicep");
---

<ProviderLayout title="Bicep" provider="Bicep" description="Deploy Azure infrastructure using Bicep templates.">
  <section id="operations" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Operations</h2>
    <OperationsTable operations={operations} />
  </section>

  <section id="details" class="mb-8">
    <h2 class="mb-6 text-xl font-bold text-zinc-900 dark:text-white">Operation Details</h2>
    <OperationDetails operations={operations} />
  </section>

  <section id="example" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Example</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">Deploy infrastructure and use outputs in subsequent steps.</p>
    <div
      class="relative overflow-x-auto rounded-xl border border-zinc-800 bg-zinc-900 p-4 font-mono text-sm leading-relaxed"
    >
      <span class="absolute top-3 right-4 text-xs tracking-wider text-zinc-400 uppercase">build.csando</span>
      <pre
        class="m-0 whitespace-pre"><code class="text-zinc-200"><span class="text-slate-400 italic">// Preview changes first</span>
<span class="text-sky-200">Bicep</span>.<span class="text-violet-300">WhatIf</span>(<span class="text-green-300">"my-app-rg"</span>, <span class="text-green-300">"./infra/main.bicep"</span>, <span class="text-amber-500">o</span> <span class="text-slate-200">=&gt;</span> <span class="text-amber-500">o</span>
  .<span class="text-violet-300">WithParameterFile</span>(<span class="text-green-300">"./infra/params.prod.json"</span>));

<span class="text-slate-400 italic">// Deploy - returns BicepDeployment with typed output access</span>
<span class="text-sky-300">var</span> <span class="text-amber-500">deployment</span> = <span class="text-sky-200">Bicep</span>.<span class="text-violet-300">DeployToResourceGroup</span>(<span class="text-green-300">"my-app-rg"</span>, <span class="text-green-300">"./infra/main.bicep"</span>, <span class="text-amber-500">o</span> <span class="text-slate-200">=&gt;</span> <span class="text-amber-500">o</span>
  .<span class="text-violet-300">WithParameterFile</span>(<span class="text-green-300">"./infra/params.prod.json"</span>));

<span class="text-slate-400 italic">// Pass deployment outputs to other operations</span>
<span class="text-sky-200">Ef</span>.<span class="text-violet-300">DatabaseUpdate</span>(<span class="text-amber-500">DbContext</span>, <span class="text-amber-500">deployment</span>.<span class="text-violet-300">Output</span>(<span class="text-green-300">"sqlConnectionString"</span>));

<span class="text-slate-400 italic">// Build Bicep to ARM for validation</span>
<span class="text-sky-200">Bicep</span>.<span class="text-violet-300">Build</span>(<span class="text-green-300">"./infra/main.bicep"</span>, <span class="text-green-300">"./artifacts/main.json"</span>);</code></pre>
    </div>
  </section>
</ProviderLayout>
