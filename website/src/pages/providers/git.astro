---
import ProviderLayout from "../../layouts/ProviderLayout.astro";
import OperationsTable from "../../components/OperationsTable.astro";
import OperationDetails from "../../components/OperationDetails.astro";
import CodeBlock from "../../components/CodeBlock.astro";
import { getOperationsForProvider } from "../../data/operations.js";

const operations = getOperationsForProvider("Git");

const exampleCode = `// Tag and push a release
var version = Dotnet.BumpVersion(app);

Git.Tag(version);  // Creates tag like v1.0.0
Git.Push();
Git.PushTags();

// Custom tag with message
Git.Tag(version, o => o.WithMessage("Release v1.0.0"));

// Lightweight tag (not annotated)
Git.Tag("my-tag", o => o.AsLightweight());

// Add and commit changes
Git.Add(".");
Git.Commit("Bump version");`;

const profileCode = `// Use profiles to run Git operations conditionally
var release = DefineProfile("release");

var version = Dotnet.BumpVersion(app);
Dotnet.Build(app);
Dotnet.Test(tests);

if (release) {
    Git.Add(".");
    Git.Commit($"Release v{version}");
    Git.Tag(version);
    Git.Push();
    Git.PushTags();
}

// CLI usage:
// ando -p release`;
---

<ProviderLayout title="Git" provider="Git" description="Version control operations using the Git CLI.">
  <section id="operations" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Operations</h2>
    <OperationsTable operations={operations} />
  </section>

  <section id="details" class="mb-8">
    <h2 class="mb-6 text-xl font-bold text-zinc-900 dark:text-white">Operation Details</h2>
    <OperationDetails operations={operations} />
  </section>

  <section id="example" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Example</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">Tag and push a release with version tracking.</p>
    <CodeBlock code={exampleCode} lang="csharp" />
  </section>

  <section id="profiles" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Using with Profiles</h2>
    <p class="mb-4 text-zinc-500 dark:text-zinc-400">
      Git operations are commonly used with profiles to run only during release workflows.
    </p>
    <CodeBlock code={profileCode} lang="csharp" />
  </section>

  <section id="notes" class="mb-8">
    <h2 class="mb-3 text-xl font-bold text-zinc-900 dark:text-white">Notes</h2>
    <ul class="list-disc space-y-2 pl-5 text-zinc-500 dark:text-zinc-400">
      <li>
        Git operations run on the <strong>host machine</strong>, not inside the container, since git credentials are
        typically configured on the host.
      </li>
      <li>
        When using <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >Git.Tag()</code
        > with a <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >VersionRef</code
        >, the version is automatically prefixed with 'v' (e.g., "1.0.0" becomes "v1.0.0").
      </li>
      <li>
        By default, <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >Git.Tag()</code
        > creates annotated tags. Use <code
          class="rounded border border-zinc-200 bg-zinc-100 px-1.5 text-sm dark:border-zinc-700 dark:bg-zinc-800"
          >.AsLightweight()</code
        > for lightweight tags.
      </li>
    </ul>
  </section>
</ProviderLayout>
