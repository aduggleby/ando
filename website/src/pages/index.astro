---
import "../styles/global.css";

const commands = [
  { cmd: "ando", desc: "Run the build script (same as 'ando run')." },
  { cmd: "ando run", desc: "Run the build script in a Docker container." },
  { cmd: "ando clean", desc: "Remove artifacts, temp files, and containers." },
  { cmd: "ando help", desc: "Show available commands and options." }
];

const runOptions = [
  { flag: "--verbosity <level>", desc: "Set output verbosity (quiet|minimal|normal|detailed)." },
  { flag: "--no-color", desc: "Disable colored output." },
  { flag: "--cold", desc: "Always create a fresh container (ignore warm cache)." },
  { flag: "--image <image>", desc: "Use a custom Docker image." },
  { flag: "--dind", desc: "Mount Docker socket for Docker-in-Docker builds." }
];

const cleanOptions = [
  { flag: "--artifacts", desc: "Remove the artifacts directory." },
  { flag: "--temp", desc: "Remove temp directory." },
  { flag: "--cache", desc: "Remove NuGet and npm caches." },
  { flag: "--container", desc: "Remove the project's warm container." },
  { flag: "--all", desc: "Remove all of the above." }
];

const operations = [
  {
    group: "Dotnet",
    name: "Dotnet.Restore",
    desc: "Restore NuGet packages for a project.",
    examples: [
      "Dotnet.Restore(App);",
      "Dotnet.Restore(App, o => o.NoCache = true);"
    ]
  },
  {
    group: "Dotnet",
    name: "Dotnet.Build",
    desc: "Compile a project with optional configuration.",
    examples: [
      "Dotnet.Build(App);",
      "Dotnet.Build(App, o => o.Configuration = Configuration.Release);"
    ]
  },
  {
    group: "Dotnet",
    name: "Dotnet.Test",
    desc: "Run unit tests for a project.",
    examples: [
      "Dotnet.Test(Tests);",
      "Dotnet.Test(Tests, o => o.Filter = \"Category=Unit\");"
    ]
  },
  {
    group: "Dotnet",
    name: "Dotnet.Publish",
    desc: "Create deployment artifacts with full publish options.",
    examples: [
      "Dotnet.Publish(App);",
      "Dotnet.Publish(App, o => o\n  .Output(Root / \"dist\")\n  .WithConfiguration(Configuration.Release)\n  .WithRuntime(\"linux-x64\")\n  .AsSelfContained()\n  .AsSingleFile());"
    ]
  },
  {
    group: "Dotnet",
    name: "Dotnet.Tool",
    desc: "Create a reference to a .NET CLI tool for installation.",
    examples: [
      "var efTool = Dotnet.Tool(\"dotnet-ef\");",
      "var efTool = Dotnet.Tool(\"dotnet-ef\", \"9.0.0\");"
    ]
  },
  {
    group: "Ef",
    name: "Ef.DbContextFrom",
    desc: "Create a reference to a DbContext in a project.",
    examples: [
      "var db = Ef.DbContextFrom(DataProject);",
      "var db = Ef.DbContextFrom(DataProject, \"AppDbContext\");"
    ]
  },
  {
    group: "Ef",
    name: "Ef.DatabaseUpdate",
    desc: "Apply pending EF Core migrations to the database.",
    examples: [
      "Ef.DatabaseUpdate(db);",
      "Ef.DatabaseUpdate(db, connectionString: \"Server=...\");"
    ]
  },
  {
    group: "Ef",
    name: "Ef.AddMigration",
    desc: "Create a new EF Core migration.",
    examples: [
      "Ef.AddMigration(db, \"InitialCreate\");",
      "Ef.AddMigration(db, \"AddUsers\", outputDir: \"Migrations\");"
    ]
  },
  {
    group: "Ef",
    name: "Ef.Script",
    desc: "Generate an idempotent SQL migration script.",
    examples: [
      "Ef.Script(db, Root / \"migration.sql\");",
      "Ef.Script(db, Root / \"migration.sql\", fromMigration: \"Init\");"
    ]
  },
  {
    group: "Ef",
    name: "Ef.RemoveMigration",
    desc: "Remove the last migration.",
    examples: [
      "Ef.RemoveMigration(db);",
      "Ef.RemoveMigration(db, force: true);"
    ]
  },
  {
    group: "Npm",
    name: "Npm.InDirectory",
    desc: "Set the working directory for npm commands.",
    examples: [
      "Npm.InDirectory(\"./frontend\");",
      "Npm.InDirectory(\"./frontend\").Install();"
    ]
  },
  {
    group: "Npm",
    name: "Npm.Install",
    desc: "Run 'npm install' to install dependencies.",
    examples: [
      "Npm.Install();",
      "Npm.InDirectory(\"./app\").Install();"
    ]
  },
  {
    group: "Npm",
    name: "Npm.Ci",
    desc: "Run 'npm ci' for clean, reproducible installs (preferred for CI).",
    examples: [
      "Npm.Ci();",
      "Npm.InDirectory(\"./app\").Ci();"
    ]
  },
  {
    group: "Npm",
    name: "Npm.Run",
    desc: "Run an npm script from package.json.",
    examples: [
      "Npm.Run(\"build\");",
      "Npm.Run(\"lint\");"
    ]
  },
  {
    group: "Npm",
    name: "Npm.Test",
    desc: "Run 'npm test'.",
    examples: [
      "Npm.Test();"
    ]
  },
  {
    group: "Npm",
    name: "Npm.Build",
    desc: "Run 'npm run build'.",
    examples: [
      "Npm.Build();"
    ]
  }
];
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ANDO - Typed C# Build System</title>
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <meta
      name="description"
      content="ANDO is a strongly typed, C#-native build system for build, test, and deploy workflows without YAML or DSLs."
    />
  </head>
  <body>
    <main>
      <nav>
        <a href="#top">ANDO</a>
        <div class="links">
          <a href="#docker">Docker</a>
          <a href="#build">build.ando</a>
          <a href="#cli">Commands</a>
          <a href="#ops">Operations</a>
        </div>
      </nav>

      <section id="top">
        <h1>Typed builds that feel like real C#.</h1>
        <p class="lede">
          ANDO executes a single <strong>build.ando</strong> file with top-level statements and typed
          operations. No YAML, no DSLs, no ceremony.
        </p>
        <p class="section-subtitle" id="docker">
          ANDO runs every workflow inside a Docker container for clean, reproducible builds. Your
          repo is mounted into <strong>/workspace</strong>, and the CLI manages container lifecycle.
        </p>
        <div class="code-block">
          <span class="label">shell</span>
          <pre><code>ando run
ando run --cold
ando run --image my-custom-image</code></pre>
        </div>
      </section>

      <section id="build">
        <h2 class="section-title">Example build.ando</h2>
        <p class="section-subtitle">
          A single C# file defines projects, tools, workflow settings, and operations.
        </p>
        <div class="code-block">
          <span class="label">build.ando</span>
          <pre><code><span class="tok-comment">// Project references</span>
<span class="tok-keyword">var</span> <span class="tok-type">WebApi</span> <span class="tok-op">=</span> <span class="tok-namespace">Project</span>.<span class="tok-func">From</span>(<span class="tok-string">"./src/WebApi/WebApi.csproj"</span>);
<span class="tok-keyword">var</span> <span class="tok-type">Frontend</span> <span class="tok-op">=</span> <span class="tok-namespace">Project</span>.<span class="tok-func">From</span>(<span class="tok-string">"./src/Frontend"</span>);

<span class="tok-comment">// Tools</span>
<span class="tok-keyword">var</span> <span class="tok-type">EfTool</span> <span class="tok-op">=</span> <span class="tok-namespace">Dotnet</span>.<span class="tok-func">Tool</span>(<span class="tok-string">"dotnet-ef"</span>, <span class="tok-prop">version</span>: <span class="tok-string">"8.0.0"</span>);
<span class="tok-keyword">var</span> <span class="tok-type">NodeTool</span> <span class="tok-op">=</span> <span class="tok-namespace">Node</span>.<span class="tok-func">Use</span>(<span class="tok-prop">version</span>: <span class="tok-string">"20.11.0"</span>);

<span class="tok-comment">// Workflow</span>
<span class="tok-func">Workflow</span>(<span class="tok-string">"ci"</span>, <span class="tok-type">w</span> <span class="tok-op">=&gt;</span>
&#123;
  <span class="tok-type">w</span>.<span class="tok-prop">Configuration</span> <span class="tok-op">=</span> <span class="tok-type">Configuration</span>.<span class="tok-type">Release</span>;
  <span class="tok-type">w</span>.<span class="tok-prop">Verbosity</span> <span class="tok-op">=</span> <span class="tok-type">Verbosity</span>.<span class="tok-type">Minimal</span>;
&#125;);

<span class="tok-comment">// Backend build</span>
<span class="tok-namespace">Dotnet</span>.<span class="tok-func">Restore</span>(<span class="tok-type">WebApi</span>);
<span class="tok-namespace">Dotnet</span>.<span class="tok-func">Build</span>(<span class="tok-type">WebApi</span>);
<span class="tok-namespace">Dotnet</span>.<span class="tok-func">Test</span>(<span class="tok-type">WebApi</span>);

<span class="tok-comment">// Frontend build</span>
<span class="tok-namespace">Npm</span>.<span class="tok-func">Ci</span>();
<span class="tok-namespace">Npm</span>.<span class="tok-func">Run</span>(<span class="tok-string">"build"</span>);

<span class="tok-comment">// Publish</span>
<span class="tok-namespace">Dotnet</span>.<span class="tok-func">Publish</span>(<span class="tok-type">WebApi</span>, <span class="tok-type">o</span> <span class="tok-op">=&gt;</span> <span class="tok-type">o</span>
  .<span class="tok-func">Output</span>(<span class="tok-type">Context</span>.<span class="tok-type">Paths</span>.<span class="tok-type">Artifacts</span> <span class="tok-op">/</span> <span class="tok-string">"publish"</span> <span class="tok-op">/</span> <span class="tok-string">"api"</span>));</code></pre>
        </div>
      </section>

      <section id="cli">
        <h2 class="section-title">ANDO commands</h2>
        <p class="section-subtitle">The CLI provides a small, focused surface area.</p>
        <table class="dir-table">
          <thead>
            <tr>
              <th>Command</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {commands.map((item) => (
              <tr>
                <td><code>{item.cmd}</code></td>
                <td>{item.desc}</td>
              </tr>
            ))}
          </tbody>
        </table>

        <h3 class="op-title">Run options</h3>
        <table class="dir-table">
          <thead>
            <tr>
              <th>Flag</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {runOptions.map((item) => (
              <tr>
                <td><code>{item.flag}</code></td>
                <td>{item.desc}</td>
              </tr>
            ))}
          </tbody>
        </table>

        <h3 class="op-title">Clean options</h3>
        <table class="dir-table">
          <thead>
            <tr>
              <th>Flag</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {cleanOptions.map((item) => (
              <tr>
                <td><code>{item.flag}</code></td>
                <td>{item.desc}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </section>

      <section id="ops">
        <h2 class="section-title">Operations directory</h2>
        <p class="section-subtitle">
          Each operation registers a deterministic step and runs inside the container.
        </p>
        {["Dotnet", "Npm", "Ef"].map((group) => (
          <div class="op-group">
            <h3 class="op-title">{group}</h3>
            <table class="dir-table">
              <thead>
                <tr>
                  <th>Operation</th>
                  <th>Description</th>
                  <th>Examples</th>
                </tr>
              </thead>
              <tbody>
                {operations
                  .filter((item) => item.group === group)
                  .map((item) => (
                    <tr>
                      <td><code>{item.name}</code></td>
                      <td>{item.desc}</td>
                      <td>
                        <pre class="mini-code"><code>{item.examples.join("\n")}</code></pre>
                      </td>
                    </tr>
                  ))}
              </tbody>
            </table>
          </div>
        ))}
      </section>

    </main>
  </body>
</html>
